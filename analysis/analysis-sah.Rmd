---
title: "The effects of mixing patterns and sex-traits on transmission and male-bias of TB"
output: pdf_document
editor_options: 
  chunk_output_type: console
header-includes: 
- \usepackage[section]{placeins}
- \usepackage{amsmath}
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(dplyr)
library(readr)
library(magrittr)
library(tidyr)
library(igraph)
library(ggplot2)
library(cowplot)
library(plotrix)
library(knitr)
library(colorspace)
library(tidyverse)
library(gridExtra)
library(ggraph)

knitr::opts_chunk$set(cache=TRUE, fig.path = "slirs-par-figs/", 
                      warning = FALSE, message=FALSE, echo=FALSE, fig.height =6, fig.width = 8) 

# colors for assortativity
assortCols <- c("#F3E79AFF", "#F7A086FF", "#CF63A6FF", "#704D9EFF")

```


Can assortativity drive male bias or are sex-trait differences required to explain male-bias?

Preliminary results for simulations of pathogen spreading on contact networks with varying levels of assortativity (r=0 to 0.9 by 0.1) and sex-trait ratios ($\alpha$). Sex-traits were susceptibility (SUS), infectious period (IP), and transmissibility (TRA). 

Rates of susceptibility for nodes (SUS) was modeled as 

| Source -> Target  | Overall transmission rate, $\beta$  | 
|:-:|:-:|
| F->F  | $\frac{2 \tau }                              {(\alpha + 1)}$ |
| M->M  | $\frac{2 \tau   \alpha}                 {(\alpha + 1)}$ |
| M->F  | $\frac{2\tau }                              {(\alpha + 1)}$ |
| F->M  | $\frac{2 \tau  \alpha}               {(\alpha + 1)}$ |

Rates of transmissibility (TRA) for nodes was modeled as 

| Source -> Target  | Overall transmission rate, $\beta$  | 
|:-:|:-:|
| F->F  | $\frac{2 \tau   }                              {(\alpha + 1)}$ |
| M->M  | $\frac{2 \tau   \alpha}                 {(\alpha + 1)}$ |
| M->F  |  $\frac{ 2 \tau  \alpha}               {(\alpha + 1)}$ |
| F->M  | $\frac{2 \tau}                              {(\alpha + 1)}$|

Infectious period (INF) for nodes modeled as 

| Source  | Overall transmission rate, $\beta$  | 
|:-:|:-:|
| F  | $\frac{\gamma (\alpha + 1)   }                              {2}$ |
| M  | $\frac{\gamma (\alpha + 1)   }                              {2\alpha}$ |

Each sex-trait was modeled separately. 

Sensitivity parameters tested: 

1. transmission rate ($\tau=0.04, 0.075, 0.1$, $R_0=1.5, 2.5, 3.5$)
2. model type (SIR, SLIR, SIRS, SLIRS). SIRS and SLIRS models ran for 200 time units. 

Response variables: 

1. Male-bias: calculated differently for SIR/SLIR and SIRS/SLIRS. For models without recovery: number of male recovered nodes at end of simulation divided by number of female recovered nodes at end of simulation. For models with recovery: average ratio of male cases to female cases in last 100 time units for each simulation. 
2. Epidemic duration: calculated for SIR/SLIR models as the number of time units before infectious population reached 0.
3. Total number infected: calculated for SIR/SLIR models as the total number of individuals that became infected before infectious population reached 0. 
4. Endemic equilibrium: calculated for SIRS/SLIRS models as the average size of the infected population in the last 100 time units. 
5. Prevalence of latent infection: calculated for SLIRS model as the average size of the latent population in the last 100 time units. 

# Notes

* Preliminary results for 150 replicates on scale-free and 150 replicates on small-world 
* One epidemic simulated per network

\clearpage


```{r, include=FALSE}
# SF network plots
n0 <- read_graph("simulations-sah/networks/GG_Q0_N1000_rep1.graphml", format="graphml")
n3 <- read_graph("simulations-sah/networks/GG_Q0.15_N1000_rep1.graphml", format="graphml")
n6 <- read_graph("simulations-sah/networks/GG_Q0.3_N1000_rep1.graphml", format="graphml")
n9 <- read_graph("simulations-sah/networks/GG_Q0.45_N1000_rep1.graphml", format="graphml")

par(mfrow=c(2,2), mar=c(0,0,0,0))
plot(n0, vertex.label="", vertex.size=1, vertex.color=c(rep(1, 500), rep(2,500)))
plot(n3, vertex.label="", vertex.size=1, vertex.color=c(rep(1, 500), rep(2,500)))
plot(n6, vertex.label="", vertex.size=1, vertex.color=c(rep(1, 500), rep(2,500)))
plot(n9, vertex.label="", vertex.size=1, vertex.color=c(rep(1, 500), rep(2,500)))


# laod simulation ANALYSIS
res <- read.csv("simulations-sah/test_res_sah.csv")

# network types
res %<>% mutate(net_type="sah") %>% rename(q=r)

res %>%
  mutate(stat="Clustering") %>%
  ggplot(aes(factor(q), net_clustering, color=factor(q))) + 
  geom_boxplot() +  
  facet_grid(net_type~stat) +
  theme_gray() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none")  +
  scale_color_discrete_sequential(palette="Sunset") +
  labs(x="Modularity  (q)", y="", color="Assortativity", title = "C") +
  guides(colour=FALSE) +
  theme_bw() +
  theme(plot.title = element_text(face="bold", size=10), 
    axis.text=element_text(size=10),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=10),
        legend.title = element_text(size=10),
        legend.text = element_text(size=10), 
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 10, color="Black"))  

res %>%
  mutate(stat="Path Length") %>%
  ggplot(aes(factor(q), net_path_len, color=factor(q))) + 
  geom_boxplot() +  
  facet_grid(net_type~stat) +
  theme_gray() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none")  +
  scale_color_discrete_sequential(palette="Sunset") +
  labs(x="Modularity  (q)", y="", color="Assortativity", title = "D") +
  guides(colour=FALSE) +
  theme_bw() +
  theme(plot.title = element_text(face="bold", size=10), 
    axis.text=element_text(size=10),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=10),
        legend.title = element_text(size=10),
        legend.text = element_text(size=10), 
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 10, color="Black"))   

res %>%
  mutate(stat="Degree assortativity") %>%
  ggplot(aes(factor(q), net_deg_assort, color=factor(q))) + 
  geom_boxplot() +  
  facet_grid(net_type~stat) +
  theme_gray() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        legend.position = "none")  +
  scale_color_discrete_sequential(palette="Sunset") +
  labs(x="Modularity  (q)", y="", color="Assortativity", title = "E") +
  guides(colour=FALSE) +
  theme_bw() +
  theme(plot.title = element_text(face="bold", size=10), 
      axis.text=element_text(size=10),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=10),
        legend.title = element_text(size=10),
        legend.text = element_text(size=10), 
        #panel.grid.major = element_blank(),
        #panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 10, color="Black"))  

```

```{r}

res$modNameLatent <- ifelse(res$reactivation_rate==0.1, T, F)
res$modNameRecover <- ifelse(res$reversion_rate==0.33, T, F)
res$modName <- NA
res$modName[!res$modNameLatent&!res$modNameRecover] <- "SIR"
res$modName[res$modNameLatent&!res$modNameRecover] <- "SLIR"
res$modName[!res$modNameLatent&res$modNameRecover] <- "SIRS"
res$modName[res$modNameLatent&res$modNameRecover] <- "SLIRS"

res$alph_type <- factor(res$alph_type, labels = c("IP", "SUS", "TRA"))


```


```{r prev-rat-heatmap-low-tau, fig.cap="The combined effects of assortativity and individual-level variation on male-bias across different sex-traits and network types. Vertical panels show type of sex-traits: Infectious period (IP), Susceptibility (SUS), and Transmissibility (TRA). Horizontal panels show model types (SLIR and SLIRS) and network type (scale-free and small-world). Color shows mean value of male:female prevalence for that parameter combination (only values above 1.25 are shown). In general, higher male susceptibility can lead to some amount of male-bias, but for SLIRS models, longer male infectious periods is a striking driver of male-bias.   ", fig.height=8}

hs <- 14 # text size
 
res %>%
  filter(!is.infinite(mf_r_ratio), tau==0.075, modName==("SLIR")) %>%
  group_by(modName, net_type, alph_type, q, alph_val) %>%
  summarise(meanPrev=mean(mf_r_ratio, na.rm=TRUE)) -> fooa

res %>%
  filter(!is.infinite(mf_i_ratio), tau==0.075, modName==c("SLIRS")) %>%
  group_by(modName, net_type, alph_type, q, alph_val) %>%
  summarise(meanPrev=mean(mf_i_ratio, na.rm=TRUE)) -> foob

# for SLIR use R, for SLIRS use I class for MF calculation
foo <- bind_rows(fooa, foob)

foo %>%
  mutate(absPrev=abs(meanPrev-1.8)) %>%
  group_by(net_type, modName, alph_type, r) %>%
  summarise(alphVal=which.min(absPrev)) -> foo2

foo %>%
  ggplot(aes(x=factor(q), y=factor(alph_val))) +
  geom_tile(aes(fill=meanPrev)) + 
  scale_fill_gradient2(midpoint=log10(1.8), trans="log10", 
                                     low="red4", mid = "dodgerblue",
                       high="black", limits=c(1.25,max(foo$meanPrev)), na.value = "white") +
  # geom_point(data=foo2, aes(x=factor(r), y=alphVal), 
  #            shape=17, color="white") +
  facet_grid(net_type ~ modName ~ alph_type) +
  labs(x="Assortativity (r)", y=expression(alpha), 
       fill="Mean \nPrevalence \nRatio", title = "R0=1.5") +
  theme_bw() +
  theme(axis.text=element_text(size=hs),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=hs,face="bold"),
        legend.title = element_text(size=hs),
        legend.text = element_text(size=hs), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 18, color="Black")) 

```

\clearpage

```{r outbreak-compare1, fig.cap="Effects of network structure on epidemic size in SLIR model and endemic level in SLIRS model. Hortizontal panels show different network types (scale-free and small-world). "}

foo <- res %>% 
  filter(modName%in% c("SIR", "SLIR"), alph_val==1) %>%
  group_by(modName, tau, r, type_net) %>%
  summarise(out_size=mean(recovered_prev))

foo %>%
  filter(modName=="SLIR") %>%
  ggplot(aes(x=as.factor(r), y=factor(tau))) +
  geom_tile(aes(fill=out_size)) + 
  scale_fill_viridis_c() +
  facet_grid(factor(type_net) ~ modName) +
  labs(x="Assortativity (r)", y=expression(tau), 
       fill="Epidemic \n size") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title.y = element_text(angle=0, vjust = 0.5),
        axis.title=element_text(size=14,face="bold"),
        legend.title = element_text(size=14),
        legend.text = element_text(size=14), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 14, color="Black")) -> p1


res %>%
  filter(modName=="SLIR", tau %in% c(0.04, 0.15)) %>%
  ggplot(aes(x=factor(r), y=recovered_prev, 
             fill=factor(type_net, labels=c("SF", "SW")))) +
  geom_boxplot()  +  facet_wrap(tau~.) +
  #scale_color_continuous_diverging() +
  labs(x="Assortativity (r)", y=("Epidemic size"), 
       fill="Network \n type", shape="Model \n type") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=14,face="bold"),
        legend.title = element_text(size=14),
        legend.text = element_text(size=14), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 14, color="Black")) -> p2

```


```{r outbreak-compare2, fig.cap="Effects of network structure on endemic prevalence in SLIRS model. Hortizontal panels show different network types (scale-free and small-world). ", fig.width=8, fig.height=7}

foo <- res %>% 
  filter(modName%in% c("SIRS", "SLIRS"), alph_val==1) %>%
  mutate(infected_prev=infected_prev/1000) %>%
  group_by(modName, tau, r, type_net) %>%
  summarise(prev=mean(infected_prev))

foo %>%
  filter(modName=="SLIRS") %>%
  ggplot(aes(x=as.factor(r), y=factor(tau))) +
  geom_tile(aes(fill=prev)) + 
  scale_fill_viridis_c() +
  facet_grid(type_net ~ modName) +
  labs(x="Assortativity (r)", y=expression(tau), 
       fill="Endemic \n prevalence") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title.y = element_text(vjust=.5, angle=0),
        axis.title=element_text(size=14,face="bold"),
        legend.title = element_text(size=14),
        legend.text = element_text(size=14), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 14, color="Black")) -> p3

res %>%
  filter(modName=="SLIRS", tau %in% c(0.04, 0.15)) %>%
  mutate(infected_prev=infected_prev/1000) %>%
  ggplot(aes(x=factor(r), y=infected_prev, 
             fill=factor(type_net, labels=c("SF", "SW")))) +
  geom_boxplot()  +  facet_wrap(tau~.) +
  #scale_color_continuous_diverging() +
  labs(x="Assortativity (r)", y=("Endemic prevalence"), 
       fill="Network \n type", shape="Model \n type") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=14,face="bold"),
        legend.title = element_text(size=14),
        legend.text = element_text(size=14), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 14, color="Black")) -> p4


grid.arrange(p1, p2, p3, p4, nrow=2)

```

\clearpage

## Results

Data exploration: 

* Male-bias similar across regions
* Commonly cited drivers of male-bias not strongly predicting male-bias at the country or regional level 
* There has to be something physiological

Network structure with varying assortativity: 

* Assortativity and modularity linearly related
* Median clustering increased in scale-free and decreased in small-world, both trending toward more "random" as assortativity increased
* Median shortest path length between nodes increased with assortativity for scale-free networks, but was relatively unchanged in small-world networks
* Median degree assortativity increased with assortativity in both network types

Which variables can lead to observed levels of male-bias: 

* In SLIR models, observed levels of male-bias (~1.5-2) are rarely observed given variables tested here. Patterns are similar for scale-free and small-world networks: observed levels of male-bias are observed in highly assortative networks with strong sex-traits. In particular, male susceptibility seems to be the strongest sex-trait driving male-bias in SLIR models. 
* In SLIRS models, observed levels of male-bias are frequently observed in parameter combinations tested here. Patterns are similar for scale-free and small-world networks: assortativity increases male-bias, although some sex-traits by themselves can drive male-bias. In particular, longer male infectious periods seem to be particularly likely to lead to male-bias in SLIRS simulations. 
* But for faster spreading (higher $R_0$) pathogens, few parameter combinations can lead to male-bias, in SLIR and SLIRS models. 
* Changing network structure (clustering, path length, degree assortativity) had little effect on results for male-bias (Supplement figures)

Effect of network structure on epidemic dynamics: 

* Assortativity had little effect on measured epidemic dynamics (epidemic size/endemic prevalence)
* Higher transmission rates led to higher epidemic sizes/endemic prevalence levels
* For pathogens with low transmission rate, assortativity increased epidemic size slightly (SLIR). In contrast, for high transmission rate pathogens, increasing assortativity decreased epidemic size (SLIR). This effect was more prominant in SF than SW networks. 
* Assortativity had a damped effect on endemic prevalence levels (SLIRS) compared with SLIR.
* However, results of epidemic dynamics were probably affected by changes in network structure (Supplement figures)

## Sensitivity analyses (Supplements)


```{r prev-rat-heatmap-high-tau, fig.cap="The combined effects of assortativity and individual-level variation on male-bias across different sex-traits and network types. Vertical panels show type of sex-traits: Infectious period (IP), Susceptibility (SUS), and Transmissibility (TRA). Horizontal panels show model types (SLIR and SLIRS) and network type (scale-free and small-world). Color shows mean value of male:female prevalence for that parameter combination (only values above 1.25 are shown). In general, higher male susceptibility can lead to some amount of male-bias, but for SLIRS models, longer male infectious periods is a striking driver of male-bias.   ", fig.height=6, fig.width=6}

hs <- 12 # text size
 
res %>%
  filter(!is.infinite(mf_r_ratio), tau==0.15, modName==("SLIR")) %>%
  group_by(modName, type_net, alph_type, r, alph_val) %>%
  summarise(meanPrev=mean(mf_r_ratio, na.rm=TRUE)) -> fooa

res %>%
  filter(!is.infinite(mf_i_ratio), tau==0.15, modName==c("SLIRS")) %>%
  group_by(modName, type_net, alph_type, r, alph_val) %>%
  summarise(meanPrev=mean(mf_i_ratio, na.rm=TRUE)) -> foob

# for SLIR use R, for SLIRS use I class for MF calculation
foo <- bind_rows(fooa, foob)

foo %>%
  mutate(absPrev=abs(meanPrev-1.8)) %>%
  group_by(type_net, modName, alph_type, r) %>%
  summarise(alphVal=which.min(absPrev)) -> foo2

foo %>%
  ggplot(aes(x=factor(r), y=factor(alph_val))) +
  geom_tile(aes(fill=meanPrev)) + 
  scale_fill_gradient2(midpoint=log10(1.8), trans="log10", 
                                     low="red4", mid = "dodgerblue",
                       high="black", limits=c(1.25,5), na.value = "white") +
  # geom_point(data=foo2, aes(x=factor(r), y=alphVal), 
  #            shape=17, color="white") +
  facet_grid(type_net ~ modName ~ alph_type) +
  labs(x="Assortativity", y=expression(alpha), 
       fill="Mean \nPrevalence \nRatio", title="R0=3.5") +
  theme_bw() +
  theme(axis.text=element_text(size=hs),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=hs,face="bold"),
        legend.title = element_text(size=hs),
        legend.text = element_text(size=hs), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 14, color="Black")) 

```

\clearpage 

```{r SLIR-prev-rat-low-tau, fig.cap="The effects of assortativity on male-bias in SLIR model.  Vertical panels show sex-trait ratios ($\\alpha$) for sex-traits shown at the bottom including male:female infectious period (IP), susceptibility (SUS), and transmissibility (TRA). Hortizontal panels show different network types (scale-free and small-world). The red dashed line shows the observed ratio of male:female cases globally and the grey dashed line represents even distribution of cases between men and women. Results for $\\tau=0.075$ shown. "}

 
res %>%
  filter(modName == "SLIR", tau == 0.075, r%in%c(0, 0.3,0.7, 0.9), alph_val%in%c(1, 2, 3)) %>%
  ggplot(aes(x=as.factor(alph_type), y=mf_r_ratio, fill=factor(r))) +
  geom_boxplot() + facet_grid(type_net ~ alph_val) +
  geom_hline(yintercept=1.8, linetype="dashed", 
                color = "red", size=.75) +    
  geom_hline(yintercept=1, linetype="dashed", 
                color = "grey", size=.5)   +
  scale_y_continuous(trans="log10", limits = c(.5, 10)) + 
  scale_fill_discrete_sequential(palette="Sunset") +
  labs(x="Sex trait", y="M:F case bias", 
       fill="Assortativity", title = "SLIR, R0=1.5") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=18,face="bold"),
        legend.title = element_text(size=18),
        legend.text = element_text(size=18), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 18, color="Black"))

```


```{r SLIR-prev-rat-high-tau, fig.cap="The effects of assortativity on male-bias in SLIR model.  Vertical panels show sex-trait ratios ($\\alpha$) for sex-traits shown at the bottom including male:female infectious period (IP), susceptibility (SUS), and transmissibility (TRA). Hortizontal panels show different network types (scale-free and small-world). The red dashed line shows the observed ratio of male:female cases globally and the grey dashed line represents even distribution of cases between men and women. Results for $\\tau=0.15$ shown. "}

 
res %>%
  filter(modName == "SLIR", tau == 0.15, r%in%c(0, 0.3, 0.6, 0.9), alph_val%in%c(1, 2, 3)) %>%
  ggplot(aes(x=as.factor(alph_type), y=mf_r_ratio, fill=factor(r))) +
  geom_boxplot() + facet_grid(type_net ~ alph_val) +
  geom_hline(yintercept=1.8, linetype="dashed", 
                color = "red", size=.75) +    
  geom_hline(yintercept=1, linetype="dashed", 
                color = "grey", size=.5)   +
  scale_y_continuous(trans="log10", limits = c(.25, 10)) + 
  scale_fill_discrete_sequential(palette="Sunset") +
  labs(x="Sex trait", y="M:F case bias", 
       fill="Assortativity", title = "SLIR, R0=3.5") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=18,face="bold"),
        legend.title = element_text(size=18),
        legend.text = element_text(size=18), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 18, color="Black"))

```

\clearpage

```{r SLIRS-prev-rat-low-tau, fig.cap="The effects of assortativity on male-bias in SLIRS model.  Vertical panels show sex-trait ratios ($\\alpha$) for sex-traits shown at the bottom including male:female infectious period (IP), susceptibility (SUS), and transmissibility (TRA). Hortizontal panels show different network types (scale-free and small-world). The red dashed line shows the observed ratio of male:female cases globally and the grey dashed line represents even distribution of cases between men and women. Results for $\\tau=0.075$ shown. "}


res %>%
  filter(modName == "SLIRS", tau == 0.075, r%in%c(0, 0.3, 0.7, 0.9), alph_val%in%c(1, 2, 3)) %>%
  ggplot(aes(x=as.factor(alph_type), y=mf_i_ratio, fill=factor(r))) +
  geom_boxplot() + facet_grid(type_net ~ alph_val) +
  geom_hline(yintercept=1.8, linetype="dashed", 
                color = "red", size=.75) +    
  geom_hline(yintercept=1, linetype="dashed", 
                color = "grey", size=.5)   +
  scale_y_continuous(trans="log10", limits = c(.25, 10)) + 
  scale_fill_discrete_sequential(palette="Sunset") +
  labs(x="Sex-trait", y="M:F case bias", 
       fill="Assortativity", title = "SLIRS, R0=1.5") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=18,face="bold"),
        legend.title = element_text(size=18),
        legend.text = element_text(size=18), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 18, color="Black"))

```

\clearpage

```{r SLIRS-prev-rat-high-tau, fig.cap="The effects of assortativity on male-bias in SLIRS model.  Vertical panels show sex-trait ratios ($\\alpha$) for sex-traits shown at the bottom including male:female infectious period (IP), susceptibility (SUS), and transmissibility (TRA). Hortizontal panels show different network types (scale-free and small-world). The red dashed line shows the observed ratio of male:female cases globally and the grey dashed line represents even distribution of cases between men and women. Results for $\\tau=0.15$ shown. "}


res %>%
  filter(modName == "SLIRS", tau == 0.15, r%in%c(0, 0.3, 0.7, 0.9), alph_val%in%c(1, 2, 3)) %>%
  ggplot(aes(x=as.factor(alph_type), y=mf_i_ratio, fill=factor(r))) +
  geom_boxplot() + facet_grid(type_net ~ alph_val) +
  geom_hline(yintercept=1.8, linetype="dashed", 
                color = "red", size=.75) +    
  geom_hline(yintercept=1, linetype="dashed", 
                color = "grey", size=.5)   +
  scale_y_continuous(trans="log10", limits = c(.25, 10)) + 
  scale_fill_discrete_sequential(palette="Sunset") +
  labs(x="Sex-trait", y="M:F case bias", 
       fill="Assortativity", title = "SLIRS, R0=3.5") +
  theme_bw() +
  theme(axis.text=element_text(size=14),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=18,face="bold"),
        legend.title = element_text(size=18),
        legend.text = element_text(size=18), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 18, color="Black"))

```



```{r structureMFbias, fig.cap="There are minimal effects of changes in network structure to male-bias. Results shown for SLIR model with $\\tau=0.1$. ", fig.width=6, fig.height=4.5}

tv <- 0.1 # tau value

resStats %>%
  filter(prev_ratio < 10, tau==tv, alph==1) %>%
  select(prev_ratio, r, net_type, clustering, pathLen, degAssort) %>%
  gather("stat", "val", 4:6) %>%
  ggplot(aes(val, prev_ratio, col=factor(r))) +
  geom_point() + geom_smooth(method="lm", color="black") + facet_grid(net_type~ stat, scales="free") +
  scale_color_discrete_sequential(palette="Sunset") +
  labs(x="", y="M:F Case Bias", color="Assortativity (r)") +
  theme_bw() +
  theme(axis.text=element_text(size=10),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=12),
        legend.title = element_text(size=12),
        legend.text = element_text(size=12), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 12, color="Black"))


```

```{r structureOutSize, fig.cap="Higher clustering and path length decrease outbreak size in scale-free and small-world networks. Degree assortativity increases outbreak size in small-world networks but decreases outbreaks in scale-free networks.  Results shown for SLIR models. ", fig.width=6, fig.height=4.5}

resStats %>%
  filter(tau==tv, alph==1, psi==0, delt<10) %>%
  select(tot_inf, r, net_type, clustering, pathLen, degAssort) %>%
  gather("stat", "val", 4:6) %>%
  ggplot(aes(val, tot_inf, col=factor(r))) +
  geom_point() + geom_smooth(method="lm", color="black") + facet_grid(net_type~ stat, scales="free") +
  scale_color_discrete_sequential(palette="Sunset") +
  labs(x="", y="Total infected", color="Assortativity (r)") +
    theme_bw() +
  theme(axis.text=element_text(size=10),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=12),
        legend.title = element_text(size=12),
        legend.text = element_text(size=12), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 12, color="Black"))


```

```{r structureEpiDur, fig.cap="Higher degree assortativity and path length decrease epidemic duration in scale-free and small-world networks. Clustering increases epidemic duration in scale-free networks but decreases epidemic duration in small-world networks.  ", fig.width=6, fig.height=4.5}

resStats %>%
  filter(tau==tv, alph==1, psi==0, delt<10) %>%
  select(time_steps, r, net_type, clustering, pathLen, degAssort) %>%
  gather("stat", "val", 4:6) %>%
  ggplot(aes(val, time_steps, col=factor(r))) +
  geom_point() + geom_smooth(method="lm", color="black") + facet_grid(net_type~ stat, scales="free") +
  scale_color_discrete_sequential(palette="Sunset") +
  labs(x="", y="Epidemic duration", color="Assortativity (r)") +
    theme_bw() +
  theme(axis.text=element_text(size=10),
        axis.text.x = element_text(hjust=1, angle=45),
        axis.title=element_text(size=12),
        legend.title = element_text(size=12),
        legend.text = element_text(size=12), 
        # panel.grid.major = element_blank(),
        # panel.grid.minor = element_blank(), 
        strip.text = element_text(size = 12, color="Black"))


```

